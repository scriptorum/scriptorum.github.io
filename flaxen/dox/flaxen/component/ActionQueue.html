<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"/><link href="../../bootstrap-combined.min.css" rel="stylesheet" /><script type="text/javascript" src="../../jquery-1.9.1.min.js"></script><script type="text/javascript" src="../../bootstrap.min.js"></script><link href="../../styles.css" rel="stylesheet" /><link rel="icon" href="../../favicon.ico" type="image/x-icon"></link><script type="text/javascript" src="../../nav.js"></script><script type="text/javascript" src="../../index.js"></script><script type="text/javascript">var dox = {rootPath: "../../",platforms: ["dox"]};</script><title>ActionQueue - Flaxen API 16-Aug-15</title></head><body><div class="navbar navbar-inverse navbar-fixed-top"><div class="navbar-inner"><form class="navbar-search pull-left" id="searchForm"><input id="search" type="text" class="search-query" placeholder="Filter" autocomplete="off"/></form><ul class="nav"><li id="select-platform" class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Platform<b class="caret"></b></a><ul class="dropdown-menu"><li data="all"><a href="#">All Platforms</a></li><li data="dox"><a href="#">dox</a></li></ul></li></ul></div></div><div id="container"><div id="nav"></div><div id="content"><div class="header"><span class="viewsource"><a href="https://github.com/scriptorum/flaxen/blob/master/source/flaxen/component/ActionQueue.hx">View source</a></span><h1><code><span class="directive">class </span><span class="type">flaxen.component.ActionQueue</span><span class="keyword"> implements</span> <a class="type" href="../../flaxen/common/Completable.html">Completable</a></code></h1></div><div class="body"><p class="availability">Available on all platforms</p><div class="doc"><p>In an entity-component-system, systems represent the behavior. Systems
examine the state of the game via the entities and their components, and
react to it, by adding/removing entities and modifying components. This in
turn can trigger another reaction, which triggers another. While systems
can be used for complicated chain of actions and reactions, sometimes it
can make the design needlessly complicated.</p>
<p>An alternative way to encode a series of actions is through an action
queue. ActionQueue is a chain of steps that modifies the game state in
sequence. Consider a dead enemy that you want to fade to white over two 
seconds, leaving a puff of smoke and eliminating the corpse. You 
overlay the corpse with an all white corpseFx entity and give it an 
Alpha of 0 (transparent). You fade in corpseFX, remove the original 
corpse, invoke a particle effect, wait for that effect to complete, and
then clean up by removing the corpseFX entity.</p>
<pre><code>	f.newActionQueue()
	.waitForWrap(new Tween(2.0)
		.addTarget(corpseFX.get(Alpha), "value", 1.0)
		.onComplete(DestroyEntity));
	.removeEntity(corpse)
	.addComponent(corpseFX, smokeEmitter)
	.waitForComplete(smokeEmitter)
	.removeEntity(corpseFX);</code></pre>
<p>This could be done with systems instead, and in many cases it should. Systems require
more boilerplate and time to implement, so for one-off effects often an ActionQueue
is preferable.</p>
<p>For an action queue to be processed, you must use ActionSystem, the ActionQueue instance
must be added to an entity, the entity must be added to Ash, and either autoStart
must be true on creation, or running set to true after creation. </p><ul><li>NOTE: ActionQueues cannot be shared between entities.</li><li>
<p>CONSIDER: Could the AQ retain a copy of the last entity/component/object it worked on,
  and then recall that entity with a special construct?</p></li></ul></div><h2>Instance Fields</h2><div class="platform platform-dox"><a name="complete"></a><h3><p><code><span class="keyword">var</span> <a href="#complete"><span class="identifier">complete</span></a>:<span class="type">Bool</span></code></p></h3><div class="doc"><p>This is set to true when the queue becomes empty</p></div></div><div class="platform platform-dox"><a name="name"></a><h3><p><code><span class="keyword">var</span> <a href="#name"><span class="identifier">name</span></a>:<span class="type">String</span></code></p></h3><div class="doc"><p>The name is primarily intended for the holding entity's name, which can be
helpful in some cases; <code><a href="../../flaxen/Flaxen.html#newActionQueue">Flaxen.newActionQueue</a></code> sets this automatically;
can be null if not defined</p></div></div><div class="platform platform-dox"><a name="onComplete"></a><h3><p><code><span class="keyword">var</span> <a href="#onComplete"><span class="identifier">onComplete</span></a>:<a class="type" href="../../flaxen/common/OnComplete.html">OnComplete</a></code></p></h3><div class="doc"><p>What to do after the action queue completes</p></div></div><div class="platform platform-dox"><a name="running"></a><h3><p><code><span class="keyword">var</span> <a href="#running"><span class="identifier">running</span></a>:<span class="type">Bool</span></code></p></h3><div class="doc"><p>The action queue is only being processed when running is true; you can set
this false to pause the processing; you can pass false for autoStart to 
delay execution</p></div></div><div class="platform platform-dox"><a name="new"></a><h3><p><code><span class="keyword">function</span> <a href="#new"><span class="identifier">new</span></a>(?f:<a class="type" href="../../flaxen/Flaxen.html">Flaxen</a>, ?onComplete:<a class="type" href="../../flaxen/common/OnComplete.html">OnComplete</a>, ?autoStart:<span class="type">Bool</span> = true, ?name:<span class="type">String</span>):<span class="type">Void</span></code></p></h3><div class="doc"><p>Creates a new ActionQueue.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>flaxen</td><td><p>The Flaxen object</p></td></tr><tr><td>onComplete</td><td><p>What to do after the queue completes</p></td></tr><tr><td>autoStart</td><td><p>If true (default) runs the queue automatically; if false, you may run the queue manually by setting <code>running</code></p></td></tr><tr><td>name</td><td><p>The name of the ActionQueue; see <code>name</code></p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="add"></a><h3><p><code><span class="keyword">function</span> <a href="#add"><span class="identifier">add</span></a>(action:<a class="type" href="../../flaxen/action/Action.html">Action</a>, ?priority:<span class="type">Bool</span> = false):<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>Adds an action to the queue.</p>
<p>The priority flag is intended to allow a callback action to modify the 
queue while its still being processed. To do this, pass true for 
priority as the last parameter. Priority actions are kept in a 
secondary queue, and will be added to front of the main queue when 
the callback completes.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>action</td><td><p>An action (command) object to add to the queue</p></td></tr><tr><td>priority</td><td><p>Set true if this is a priority action</p></td></tr><tr><td>returns</td><td><p>This ActionQueue object</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="addActions"></a><h3><p><code><span class="keyword">function</span> <a href="#addActions"><span class="identifier">addActions</span></a>(actions:<span class="type">Array</span>&lt;<a class="type" href="../../flaxen/action/Action.html">Action</a>&gt;):<span class="type">Void</span></code></p></h3><div class="doc"><p>Adds an array of actions at once.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>actions</td><td><p>The array</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="addComponent"></a><h3><p><code><span class="keyword">function</span> <a href="#addComponent"><span class="identifier">addComponent</span></a>(entityRef:<a class="type" href="../../flaxen/EntityRef.html">EntityRef</a>, component:<span class="type">Dynamic</span>, ?priority:<span class="type">Bool</span> = false):<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>Adds a component to an existing entity</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>entityRef</td><td><p>The existing entity to receive the component</p></td></tr><tr><td>component</td><td><p>The component to be added</p></td></tr><tr><td>priority</td><td><p>Set true if this is a priority action (see <code>add()</code>)</p></td></tr><tr><td>returns</td><td><p>This ActionQueue object</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="addEntity"></a><h3><p><code><span class="keyword">function</span> <a href="#addEntity"><span class="identifier">addEntity</span></a>(entityRef:<a class="type" href="../../flaxen/EntityRef.html">EntityRef</a>, ?priority:<span class="type">Bool</span> = false):<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>Adds an entity to Ash that hasn't been added yet. 
See <code>newEntity(..., false)</code> in Flaxen or <code>new Entity()</code> in Ash.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>entityRef</td><td><p>An entity to be added</p></td></tr><tr><td>priority</td><td><p>Set true if this is a priority action (see <code>add()</code>)</p></td></tr><tr><td>returns</td><td><p>This ActionQueue object</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="addSet"></a><h3><p><code><span class="keyword">function</span> <a href="#addSet"><span class="identifier">addSet</span></a>(entityRef:<a class="type" href="../../flaxen/EntityRef.html">EntityRef</a>, setName:<span class="type">String</span>, ?priority:<span class="type">Bool</span> = false):<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>Adds a component set to an entity.</p>
<p>Applies all the batch operations stored in the component set to the supplied entity.
See <code><a href="../../flaxen/ComponentSet.html">ComponentSet</a></code>.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>entityRef</td><td><p>The existing entity to which the <code><a href="../../flaxen/ComponentSet.html">ComponentSet</a></code> is applied</p></td></tr><tr><td>setName</td><td><p>The name of the <code><a href="../../flaxen/ComponentSet.html">ComponentSet</a></code> (as defined by <code><a href="../../flaxen/Flaxen.html#addSet">Flaxen.addSet</a></code>) to apply to entityRef</p></td></tr><tr><td>priority</td><td><p>Set true if this is a priority action (see <code>add()</code>)</p></td></tr><tr><td>returns</td><td><p>This ActionQueue object</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="call"></a><h3><p><code><span class="keyword">function</span> <a href="#call"><span class="identifier">call</span></a>(func:<span class="type">Void</span> -&gt;<span class="type">Void</span>, ?priority:<span class="type">Bool</span> = false):<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>Calls a function that accepts no parameters and returns nothing.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>func</td><td><p>An anonymous function in the form of Void->Void</p></td></tr><tr><td>priority</td><td><p>Set true if this is a priority action (see <code>add()</code>)</p></td></tr><tr><td>returns</td><td><p>This ActionQueue object</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="execute"></a><h3><p><code><span class="keyword">function</span> <a href="#execute"><span class="identifier">execute</span></a>():<span class="type">Bool</span></code></p></h3><div class="doc"><p>Executes the next action(s) and returns true if the action queue is empty
When actions are completed, they are removed from the queue and the next
action is executed. An action can hold up the queue by returning false
for its execute method, in which case it will be called again later.
See ActionSystem.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>returns</td><td><p>True if the all actions have been processed; if false, call execute again to process actions further.</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="log"></a><h3><p><code><span class="keyword">function</span> <a href="#log"><span class="identifier">log</span></a>(message:<span class="type">String</span>, ?priority:<span class="type">Bool</span> = false):<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>Logs a message to the console.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>message</td><td><p>The string to log</p></td></tr><tr><td>priority</td><td><p>Set true if this is a priority action (see <code>add()</code>)</p></td></tr><tr><td>returns</td><td><p>This ActionQueue object</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="pause"></a><h3><p><code><span class="keyword">function</span> <a href="#pause"><span class="identifier">pause</span></a>():<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>Pauses the action queue.</p>
<p>Call <code>resume</code> to continue.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>returns</td><td><p>This action queue instance</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="removeComponent"></a><h3><p><code><span class="keyword">function</span> <a href="#removeComponent"><span class="identifier">removeComponent</span></a>(entityRef:<a class="type" href="../../flaxen/EntityRef.html">EntityRef</a>, component:<span class="type">Class</span>&lt;<span class="type">Dynamic</span>&gt;, ?priority:<span class="type">Bool</span> = false):<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>Removes a component from an entity.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>entityRef</td><td><p>The entity with the component</p></td></tr><tr><td>component</td><td><p>The component to be removed</p></td></tr><tr><td>priority</td><td><p>Set true if this is a priority action; see <code>add()</code></p></td></tr><tr><td>returns</td><td><p>This ActionQueue object</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="removeEntity"></a><h3><p><code><span class="keyword">function</span> <a href="#removeEntity"><span class="identifier">removeEntity</span></a>(entityRef:<a class="type" href="../../flaxen/EntityRef.html">EntityRef</a>, ?priority:<span class="type">Bool</span> = false):<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>Removes an entity from Ash.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>entityRef</td><td><p>An entity object to be removed, or the string name of such an entity</p></td></tr><tr><td>priority</td><td><p>Set true if this is a priority action (see <code>add()</code>)</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="resume"></a><h3><p><code><span class="keyword">function</span> <a href="#resume"><span class="identifier">resume</span></a>():<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>Resumes a paused action queue.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>returns</td><td><p>This action queue instance</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="setName"></a><h3><p><code><span class="keyword">function</span> <a href="#setName"><span class="identifier">setName</span></a>(name:<span class="type">String</span>):<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>Sets the <code>name</code> of this action queue.</p>
<p>The name is primarily intended for the holding entity's name, which can be
used to look up the entity in Ash. See <code>name</code> for more.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>name</td><td><p>The name of the action queue</p></td></tr><tr><td>returns</td><td><p>This ActionQueue object</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="setOnComplete"></a><h3><p><code><span class="keyword">function</span> <a href="#setOnComplete"><span class="identifier">setOnComplete</span></a>(onComplete:<a class="type" href="../../flaxen/common/OnComplete.html">OnComplete</a>):<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>Immediately sets <code>onComplete</code>.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>OnComplete</td><td><p>What to do after the action queue completes</p></td></tr><tr><td>returns</td><td><p>This ActionQueue object</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="setProperty"></a><h3><p><code><span class="keyword">function</span> <a href="#setProperty"><span class="identifier">setProperty</span></a>(object:<span class="type">Dynamic</span>, property:<span class="type">String</span>, value:<span class="type">Dynamic</span>, ?priority:<span class="type">Bool</span> = false):<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>Sets the property of an object to a value. As in, <code>object.property = value;</code>.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>object</td><td><p>An object with a matching property</p></td></tr><tr><td>property</td><td><p>A string representing the name of the property</p></td></tr><tr><td>value</td><td><p>The value to set the property to</p></td></tr><tr><td>priority</td><td><p>Set true if this is a priority action (see <code>add()</code>)</p></td></tr><tr><td>returns</td><td><p>This ActionQueue object</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="wait"></a><h3><p><code><span class="keyword">function</span> <a href="#wait"><span class="identifier">wait</span></a>(seconds:<span class="type">Float</span>, ?priority:<span class="type">Bool</span> = false):<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>Delays an amount of time before continuing the action queue.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>seconds</td><td><p>The number seconds to wait</p></td></tr><tr><td>priority</td><td><p>Set true if this is a priority action (see <code>add()</code>)</p></td></tr><tr><td>returns</td><td><p>This ActionQueue object</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="waitForCall"></a><h3><p><code><span class="keyword">function</span> <a href="#waitForCall"><span class="identifier">waitForCall</span></a>(func:<span class="type">Void</span> -&gt;<span class="type">Bool</span>, ?priority:<span class="type">Bool</span> = false):<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>Calls a function repeatedly, that accepts no parameters and returns a boolean value,
until that function returns true. This works sort of like a thread.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>func</td><td><p>An anonymous function in the form of Void->Bool</p></td></tr><tr><td>priority</td><td><p>Set true if this is a priority action (see <code>add()</code>)</p></td></tr><tr><td>returns</td><td><p>This ActionQueue object</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="waitForComplete"></a><h3><p><code><span class="keyword">function</span> <a href="#waitForComplete"><span class="identifier">waitForComplete</span></a>(completable:<a class="type" href="../../flaxen/common/Completable.html">Completable</a>, ?priority:<span class="type">Bool</span> = false):<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-dox"><a name="waitForProperty"></a><h3><p><code><span class="keyword">function</span> <a href="#waitForProperty"><span class="identifier">waitForProperty</span></a>(object:<span class="type">Dynamic</span>, property:<span class="type">String</span>, value:<span class="type">Dynamic</span>, ?priority:<span class="type">Bool</span> = false):<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>Waits for the value of an object's property to reach a certain value.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>object</td><td><p>An object with a matching property</p></td></tr><tr><td>property</td><td><p>A string representing the name of the property</p></td></tr><tr><td>value</td><td><p>The value to wait for</p></td></tr><tr><td>priority</td><td><p>Set true if this is a priority action (see <code>add()</code>)</p></td></tr><tr><td>returns</td><td><p>This ActionQueue object</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="waitForWrap"></a><h3><p><code><span class="keyword">function</span> <a href="#waitForWrap"><span class="identifier">waitForWrap</span></a>(completable:<a class="type" href="../../flaxen/common/Completable.html">Completable</a>, ?name:<span class="type">String</span> = null, ?priority:<span class="type">Bool</span> = false):<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>Wraps a <code><a href="../../flaxen/common/Completable.html">Completable</a></code> component into a new entity.
Creates a new entity with an unique name, adds it to Ash, and adds the component to the entity.
Waits until the component's <code>complete</code> property to become true.
This is useful for adding new Tweens and Sounds, for instance, or perhaps a nested ActionQueue.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>component</td><td><p>A Completable component to wrap into a new entity and wait for</p></td></tr><tr><td>name</td><td><p>An optional name or pattern the the wrapping entity; see <code><a href="../../flaxen/Flaxen.html#newEntity">Flaxen.newEntity</a></code></p></td></tr><tr><td>priority</td><td><p>Set true if this is a priority action (see <code>add()</code>)</p></td></tr><tr><td>returns</td><td><p>This ActionQueue object</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="waitOnce"></a><h3><p><code><span class="keyword">function</span> <a href="#waitOnce"><span class="identifier">waitOnce</span></a>(?priority:<span class="type">Bool</span> = false):<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>During testing I've found at times to have an action that waits one 
frame before resuming. This achieves that.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>returns</td><td><p>This ActionQueue object</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="wrap"></a><h3><p><code><span class="keyword">function</span> <a href="#wrap"><span class="identifier">wrap</span></a>(component:<span class="type">Dynamic</span>, ?name:<span class="type">String</span> = null, ?priority:<span class="type">Bool</span> = false):<a class="type" href="../../flaxen/component/ActionQueue.html">ActionQueue</a></code></p></h3><div class="doc"><p>Wraps a component into a new entity.
Creates a new entity with an unique name, adds it to ash, and adds the component to the entity.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>component</td><td><p>The component to "wrap" into a new entity</p></td></tr><tr><td>name</td><td><p>An optional name or pattern the the wrapping entity; see <code><a href="../../flaxen/Flaxen.html#newEntity">Flaxen.newEntity</a></code></p></td></tr><tr><td>priority</td><td><p>Set true if this is a priority action (see <code>add()</code>)</p></td></tr><tr><td>returns</td><td><p>This ActionQueue object</p></td></tr></tbody></table></div></div></div></div></div></body></html>